#!/bin/sh

. bspwm_panel_config

while read -r line; do
    case $line in
        D*) # clock output
            var_datetime="${line#?}"
            ;;

        R*) # RAM in use
            var_useram="${line#?}"
            ;;

        B*) # Battery power
            var_battery="${line#?}"
            ;;

        C*) # CPU usage
            var_cpu="${line#?}"
            ;;

        T*) # xtitle output
            title="${line#?}"
            ;;

        W*) # bspwm internal state
            wm_infos=""
            IFS=':'
            set -- ${line#?}
            while [ $# -gt 0 ] ; do
                item=$1
                name=${item#?}
                case $item in
                    O*) # focused occupied desktop
                        wm_infos="$wm_infos %{F${COLOR_FOCUSED_FG}}$name⠁%{F${COLOR_FOREGROUND}}⮁"
                        ;;

                    F*) # focused free desktop
                        wm_infos="$wm_infos %{F${COLOR_FOCUSED_FG}}$name %{F${COLOR_FOREGROUND}}⮁"
                        ;;

                    U*) # focused urgent desktop
                        wm_infos="$wm_infos %{F${COLOR_FOREGROUND}}$name⠁%{F${COLOR_FOREGROUND}}⮁"
                        ;;

                    o*) # occupied desktop
                        wm_infos="$wm_infos %{F${COLOR_FOREGROUND}}$name⠁%{F${COLOR_FOREGROUND}}⮁"
                        ;;

                    f*) # free desktop
                        wm_infos="$wm_infos %{F${COLOR_FOREGROUND}}$name %{F${COLOR_FOREGROUND}}⮁"
                        ;;

                    u*) # urgent desktop
                        wm_infos="$wm_infos %{F${COLOR_FOREGROUND}}$name⠁%{F${COLOR_FOREGROUND}}⮁"
                        ;;

                    L*) # layout
                        #layout=$(printf "%s" "${name}" | sed 's/\(.\).*/\U\1/')
                        #wm_infos="$wm_infos [$layout]"
                        ;;
                esac
                shift
            done
    esac

printf "%s\n" "%{l}\
$wm_infos \
%{F${COLOR_FOREGROUND}}\
%{r}⮃ \
⭯ none ⮃ \
⭟ 0 ⮃ \
⭮ 0, 2, 3 ⮃ \
⭥ $var_cpu ⮃ \
⭦ $var_useram ⮃ \
%{fa}⮏%{fm} $var_battery ⮃ \
%{fm}⭧ $var_datetime "

## Powerline example
#%{F#FFFF0000}⮂%{B#FFFF0000}%{F#FFFFFFFF} POWERLINE TEXT HERE %{F${COLOR_BACKGROUND}}⮂%{F${COLOR_FOREGROUND}}%{B${COLOR_BACKGROUND}} \

done


# !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghi
#jklmnopqrstuvwxyz{|}~ ¡¢£¤¥¦§¨©ª«¬­®¯°±²³´µ¶·¸¹º»¼½¾¿ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚ
#ÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõö÷øùúûüýþÿĀāĂăĄąĆćĈĉĊċČčĎďĐđĒēĔĕĖėĘęĚěĜĝĞğĠġĢģĤĥĦħĨĩĪ
#īĬĭĮįİıĲĳĴĵĶķĸĹĺĻļĽľĿŀŁłŃńŅņŇňŉŊŋŌōŎŏŐőŒœŔŕŖŗŘřŚśŜŝŞşŠšŢţŤťŦŧŨũŪūŬŭŮůŰűŲųŴŵŶŷŸŹź
#ŻżŽžſƀƁƂƃƄƅƆƇƈƉƊƋƌƍƎƏƐƑƒƓƔƕƖƗƘƙƚƛƜƝƞƟƠơƢƣƤƥƦƧƨƩƪƫƬƭƮƯưƱƲƳƴƵƶƷƸƹƺƻƼƽƾƿǀǁǂǃǄǅǆǇǈǉǊ
#ǋǌǍǎǏǐǑǒǓǔǕǖǗǘǙǚǛǜǝǞǟǠǡǢǣǤǥǦǧǨǩǪǫǬǭǮǯǰǱǲǳǴǵǶǷǸǹǺǻǼǽǾǿȀȁȂȃȄȅȆȇȈȉȊȋȌȍȎȏȐȑȒȓȔȕȖȗȘșȚ
#țȜȝȞȟȠȡȢȣȤȥȦȧȨȩȪȫȬȭȮȯȰȱȲȳȴȵȶȷȸȹȺȻȼȽȾȿɀɁɂɃɄɅɆɇɈɉɊɋɌɍɎɏɐɑɒɓɔɕɖɗɘəɚɛɜɝɞɟɠɡɢɣɤɥɦɧɨɩɪ
#ɫɬɭɮɯɰɱɲɳɴɵɶɷɸɹɺɻɼɽɾɿʀʁʂʃʄʅʆʇʈʉʊʋʌʍʎʏʐʑʒʓʔʕʖʗʘʙʚʛʜʝʞʟʠʡʢʣʤʥʦʧʨʩʪʫʬʭʮʯʰʱʲʳʴʵʶʷʸʹʺ
#ʻʼʽ˂˃˄˅ˆˇˈˉˊˋːˑ˘˙˚˛˜˝˞ˠˤˮ̜̟̠̤̥̪̬̰̹̺̻̼̀́̂̃̄̅̆̇̈̉̊̋̌̍̎̐̑̒̓̔̓̈́̕̚͜͡ͰͱͲͳʹ͵Ͷͷͺͻͼͽ;Ϳ΀΁΄
#΅Ά·ΈΉΊΌΎΏΐΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩΪΫάέήίΰαβγδεζηθικλμνξοπρςστυφχψωϊϋόύώϏϐϑϒϓϔϕϖϗ
#ϘϙϚϛϜϝϞϟϠϡϢϣϤϥϦϧϨϩϪϫϬϭϮϯϰϱϲϳϴϵ϶ϷϸϹϺϻϼϽϾϿЀЁЂЃЄЅІЇЈЉЊЋЌЍЎЏАБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧ
#ШЩЪЫЬЭЮЯабвгдежзийклмнопрстуфхцчшщъыьэюяѐёђѓєѕіїјљњћќѝўџѠѡѢѣѤѥѦѧѨѩѪѫѬѭѮѯѰѱѲѳѴѵѶѷ
#ѸѹѺѻѼѽѾѿ҂Ґґԅلڡ߸߹ߺ౪ಠಥง฿๑ຈ༼༽ლᕗᕙᴥḀḁḂḃḄḅḆḇḈḉḊḋḌḍḎḏḐḑḒḓḔḕḖḗḘḙḚḛḜḝḞḟḠḡḢḣḤḥḦḧḨḩḪḫḬḭḮḯḰḱ
#ḲḳḴḵḶḷḸḹḺḻḼḽḾḿṀṁṂṃṄṅṆṇṈṉṊṋṌṍṎṏṐṑṒṓṔṕṖṗṘṙṚṛṜṝṞṟṠṡṢṣṤṥṦṧṨṩṪṫṬṭṮṯṰṱṲṳṴṵṶṷṸṹṺṻṼṽṾṿẀẁ
#ẂẃẄẅẆẇẈẉẊẋẌẍẎẏẐẑẒẓẔẕồ‐‑‒–—―‖‗‘’‚‛“”„‟†‡•‣․‥…‧‰‱′″‴‵‶‷‸‹›‼‽‾‿⁀⁁⁂⁃⁄⁅⁆⁇⁈⁉⁊⁋⁌⁍⁎⁏⁐⁑⁒⁓
#⁔⁕⁖⁗⁘⁙⁚⁛⁜⁝⁞⁰ⁱ⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿ₀₁₂₃₄₅₆₇₈₉₊₋₌₍₎ₐₑₒₓₔₕₖₗₘₙₚₛₜ₠₡₢₣₤₥₦₧€℃℉№℗™℥Ω℧KÅℯℳℴⅬ←↑→↓
#↔↕↖↗↘↙↚↛↜↝↞↟↠↡↢↣↤↥↦↧↨↩↪↫↬↭↮↯↰↱↲↳↴↵↶↷↸↹↺↻↼↽↾↿⇀⇁⇂⇃⇄⇅⇆⇇⇈⇉⇊⇋⇌⇐⇞⇟⇥⇧⇮⇱⇲⇵⇶⇷⇸⇽⇾⇿∀∁∂∃∄∅∆∇
#∈∉∊∋∌∍∏∐∑−∓∔∕√∛∜∝∞∣∩∫∴≈≖≠≤≥≦≧⊃⊆⊕⊖⊗⊘⊙⌂⌒⌢⌣⌦⌫⎀⎈⎋⏩⏪⏫⏬⏭⏮⏯␣①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳⑴⑵⑶⑷⑸⑹⑺
#⑻⑼⑽⑾⑿⒀⒁⒂⒃⒄⒅⒆⒇⒈⒉⒊⒋⒌⒍⒎⒏⒐⒑⒒⒓⒔⒕⒖⒗⒘⒙⒚⒛⒜⒝⒞⒟⒠⒡⒢⒣⒤⒥⒦⒧⒨⒩⒪⒫⒬⒭⒮⒯⒰⒱⒲⒳⒴⒵▖▗▘▙▚▛▜▝▞▟■□▢▣▤▥▦▧▨▩▪
#▫▬▭▮▯▰▱▲△▴▵▶▷▸▹►▻▼▽▾▿◀◁◂◃◄◅◆◇◈◉◊○◌◍◎●◐◑◒◓◔◕◖◗◘◙◚◛◜◝◞◟◠◡◢◣◤◥◦◧◨◩◪◫◬◭◮◯◰◱◲◳◴◵◶◷◸◹◺
#◻◼◽◾◿☀☁☂☃☄★☆☇☈☉☐☑☖☗☞☰☱☲☳☴☵☶☷☿♀♁♂♠♡♢♣♤♥♦♧♩♪♫♬♭♮♯⚢⚣⚤⚥⚦⚧⚨⚩✈✓✔✕✖✗✘✚✛✜✝✞✟✠✡✤✥✦✧✩✪✫✳✶✿
#❁❏❐❑❒❛❜❝❞❟❠❤❥❦❬❭❮❯❰❱➊➋➌➍➎➏➐➑➒➓➔➕➖➗➘➙➚➛⟨⟩⠀⠁⠂⠃⠄⠅⠆⠇⠈⠉⠊⠋⠌⠍⠎⠏⠐⠑⠒⠓⠔⠕⠖⠗⠘⠙⠚⠛⠜⠝⠞⠟⠠⠡⠢⠣⠤⠥⠦⠧
#⠨⠩⠪⠫⠬⠭⠮⠯⠰⠱⠲⠳⠴⠵⠶⠷⠸⠹⠺⠻⠼⠽⠾⠿⡀⡁⡂⡃⡄⡅⡆⡇⡈⡉⡊⡋⡌⡍⡎⡏⡐⡑⡒⡓⡔⡕⡖⡗⡘⡙⡚⡛⡜⡝⡞⡟⡠⡡⡢⡣⡤⡥⡦⡧⡨⡩⡪⡫⡬⡭⡮⡯⡰⡱⡲⡳⡴⡵⡶⡷
#⡸⡹⡺⡻⡼⡽⡾⡿⢀⢁⢂⢃⢄⢅⢆⢇⢈⢉⢊⢋⢌⢍⢎⢏⢐⢑⢒⢓⢔⢕⢖⢗⢘⢙⢚⢛⢜⢝⢞⢟⢠⢡⢢⢣⢤⢥⢦⢧⢨⢩⢪⢫⢬⢭⢮⢯⢰⢱⢲⢳⢴⢵⢶⢷⢸⢹⢺⢻⢼⢽⢾⢿⣀⣁⣂⣃⣄⣅⣆⣇
#⣈⣉⣊⣋⣌⣍⣎⣏⣐⣑⣒⣓⣔⣕⣖⣗⣘⣙⣚⣛⣜⣝⣞⣟⣠⣡⣢⣣⣤⣥⣦⣧⣨⣩⣪⣫⣬⣭⣮⣯⣰⣱⣲⣳⣴⣵⣶⣷⣸⣹⣺⣻⣼⣽⣾⣿
# ⭐ ⭟ ⭠ ⭡ ⭢ ⭣ ⭤ ⭥ ⭦  ⭧ ⭨ ⭩ ⭪ ⭫ ⭬ ⭭ ⭮ ⭯ ⮀ ⮁ ⮂ ⮃ ⱱ ⸘
# ⮎ ⮒ ⮏ ⮑ ⮐
# ⮜ ⮞ ⮟ ⮝
#⮷ ⮸ ⮹
# ⮡ ⮦ ⮰
# ⮤ ⮩
# ⮛ ⮨ ⮘ ⮙ ⮚ ⮧ ⮽
# ⮾ ⮿ ⯀ ⯁ ⯂ ⯃ ⯄ ⯅ ⯆ ⯇ ⯈
# ⮕ ⮓ ⮔ ⮲ ⮳
# ⮫ ⮬ ⮭ ⮮ ⮯ 
# ⮴ ⮵
# ⮗ ⮢
# ⮖ ⮠ ⮣ ⮪ ⮥ ⮺ ⮻ ⮼